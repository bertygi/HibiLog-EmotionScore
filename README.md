# Emotion Score Program
çµµæ–‡å­—ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’çµ„ã¿åˆã‚ã›ãŸæ„Ÿæƒ…åˆ†æãƒ—ãƒ­ã‚°ãƒ©ãƒ 

---

## æ¦‚è¦
æœ¬ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€**Hugging Face** ã®å­¦ç¿’æ¸ˆã¿æ—¥æœ¬èªæ„Ÿæƒ…åˆ†æãƒ¢ãƒ‡ãƒ«  
[`patrickramos/bert-base-japanese-v2-wrime-fine-tune`](https://huggingface.co/patrickramos/bert-base-japanese-v2-wrime-fine-tune)  
ã‚’åˆ©ç”¨ã—ã€ãƒ†ã‚­ã‚¹ãƒˆãŠã‚ˆã³çµµæ–‡å­—ã®æƒ…å ±ã‹ã‚‰ç·åˆçš„ãªæ„Ÿæƒ…ã‚¹ã‚³ã‚¢ï¼ˆ`combined_score`ï¼‰ã‚’ç®—å‡ºã—ã¾ã™ã€‚

ãƒ†ã‚­ã‚¹ãƒˆã®æ„Ÿæƒ…å¼·åº¦ï¼ˆ`text_sent_score`ï¼‰ã¯ WRIME ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚Šãƒ­ã‚¸ãƒƒãƒˆå€¤ã‹ã‚‰æ¨å®šã•ã‚Œã€  
çµµæ–‡å­—ã®ã‚¹ã‚³ã‚¢ï¼ˆ`emoji_score`ï¼‰ã¨é‡ã¿ä»˜ãã§çµ±åˆã•ã‚Œã¾ã™ã€‚

---

## ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«
- **ãƒ¢ãƒ‡ãƒ«å**: `patrickramos/bert-base-japanese-v2-wrime-fine-tune`  
- **å…¥åŠ›**: æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆ  
- **å‡ºåŠ›**: 8ã¤ã®æ„Ÿæƒ…ã‚¹ã‚³ã‚¢  
  ï¼ˆjoy, sadness, anticipation, surprise, anger, fear, disgust, trustï¼‰

---

## ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | æ„å‘³ | æ—¢å®šå€¤ |
|-------------|------|--------|
| `ALPHA` | ä¿¡é ¼åº¦ã«åŸºã¥ãé‡ã¿è¨ˆç®—ä¿‚æ•° | 0.5 |
| `BETA` | é‡ã¿ã®ãƒ™ãƒ¼ã‚¹å€¤ | 0.2 |
| `EPS` | æ•°å€¤å®‰å®šåŒ–ç”¨ã®å¾®å°å€¤ | 1e-6 |
| `EMOJI_SCORE` | çµµæ–‡å­—ã”ã¨ã®æ„Ÿæƒ…ã‚¹ã‚³ã‚¢è¾æ›¸ | â¤ï¸:+0.9, ğŸ™‚:+0.6, ğŸ˜¢:-0.6, ğŸ˜±:-0.9, ğŸ˜–:-0.5, ğŸ”¥:+0.5, ğŸ˜¡:-0.8, ğŸ‘:+0.6 |

---

## å‡¦ç†ã®æµã‚Œ

### â‘  ãƒ†ã‚­ã‚¹ãƒˆæ„Ÿæƒ…ã‚¹ã‚³ã‚¢ï¼ˆ`text_sent_score`ï¼‰
WRIME ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰å¾—ã‚‰ã‚ŒãŸå„æ„Ÿæƒ…ãƒ­ã‚¸ãƒƒãƒˆå€¤ã‚’ã‚‚ã¨ã«ã€  
**log-sum-expï¼ˆLSEï¼‰ãƒ™ãƒ¼ã‚¹**ã§ãƒã‚¸ãƒ†ã‚£ãƒ–ãƒ»ãƒã‚¬ãƒ†ã‚£ãƒ–ã®ä»£è¡¨å€¤ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

$$
\begin{aligned}
L_{\mathrm{pos}} &= \log \sum_{i \in \{\mathrm{joy},\ \mathrm{trust},\ \mathrm{anticipation}\}} e^{z_i} \\
L_{\mathrm{neg}} &= \log \sum_{j \in \{\mathrm{sadness},\ \mathrm{anger},\ \mathrm{fear},\ \mathrm{disgust}\}} e^{z_j} \\
p_{\mathrm{pos}} &= \frac{1}{1 + e^{-(L_{\mathrm{pos}} - L_{\mathrm{neg}})}} \\
s_{\text{text}} &= 2\,p_{\mathrm{pos}} - 1 \quad (-1 \le s_{\text{text}} \le 1)
\end{aligned}
$$


ã¾ãŸã€ãƒ¢ãƒ‡ãƒ«å‡ºåŠ›ã®ä¿¡é ¼åº¦ `c` ã¯2ã‚¯ãƒ©ã‚¹åˆ†å¸ƒã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã‹ã‚‰ç®—å‡ºã—ã¾ã™ã€‚

```math
c = 1 - \frac{H}{\log 2}, \quad H = -[p_{pos}\log p_{pos} + p_{neg}\log p_{neg}]
```

---

### â‘¡ é‡ã¿è¨ˆç®—
ãƒ†ã‚­ã‚¹ãƒˆã®ä¿¡é ¼åº¦ `c` ã«åŸºã¥ãã€çµµæ–‡å­—ã¨ãƒ†ã‚­ã‚¹ãƒˆã®æ¯”é‡ã‚’æ±ºå®šã—ã¾ã™ã€‚

```math
w_2 = clip(\alpha \cdot c + \beta, 0, 1)
\quad , \quad
w_1 = 1 - w_2
```

---

### â‘¢ ç·åˆæ„Ÿæƒ…ã‚¹ã‚³ã‚¢ï¼ˆ`combined_score`ï¼‰
çµµæ–‡å­—ã‚¹ã‚³ã‚¢ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚³ã‚¢ã‚’åŠ é‡å¹³å‡ã—ã¦ç·åˆã‚¹ã‚³ã‚¢ã‚’å¾—ã¾ã™ã€‚

```math
s_{combined} = w_1 \cdot s_{emoji} + w_2 \cdot s_{text}
```

æœ€çµ‚çš„ã« `[-1, 1]` ã®ç¯„å›²ã‚’ `0~100` ã«å†ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚

```math
s_{combined\_100} = \frac{(s_{combined} + 1)}{2} \times 100
```

---

## å‡ºåŠ›ä¾‹

```
--- æ„Ÿæƒ…ã‚¹ã‚³ã‚¢çµæœ ---
text: ä»Šæ—¥ã¯å‹é”ã¨ä¼šãˆã¦ã¨ã¦ã‚‚å¬‰ã—ã„ï¼
emoji: ğŸ™‚
emoji_score: 0.6
text_sent_score: 0.697
confidence(c): 0.386
w1: 0.607
w2: 0.393
combined_score: 0.638
combined_score_100: 81.9
emotion_values: {'joy': 2.989, 'sadness': -0.044, 'anticipation': 0.231, 'surprise': 0.256, 'anger': -0.071, 'fear': 0.018, 'disgust': -0.035, 'trust': 0.172}
```

---

## ä¸»ãªé–¢æ•°

| é–¢æ•°å | èª¬æ˜ |
|---------|------|
| `get_text_sent_score(text)` | WRIMEãƒ¢ãƒ‡ãƒ«ã‚’ç”¨ã„ã¦ãƒ†ã‚­ã‚¹ãƒˆã®æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ã¨ä¿¡é ¼åº¦ã‚’ç®—å‡º |
| `get_combined_score(text, emoji)` | ãƒ†ã‚­ã‚¹ãƒˆã¨çµµæ–‡å­—ã‚’çµ±åˆã—ã€æœ€çµ‚ã‚¹ã‚³ã‚¢ã‚’ç®—å‡º |
| `emotion_values` | å„æ„Ÿæƒ…ï¼ˆjoy/sadnessç­‰ï¼‰ã®ç”Ÿãƒ­ã‚¸ãƒƒãƒˆå€¤ã‚’æ ¼ç´ |

---